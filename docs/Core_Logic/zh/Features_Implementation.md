# 构筑物生成实现 (Features Implementation)

## 1. 栈道生成 (Boardwalk Generation)
栈道系统将路径曲线转换为包含桥面、支撑和栏杆的三维结构模型。

### 1.1 桥面逻辑 (Deck Logic)
*   **框架构建 (Framing)**: 沿路径按固定间隔生成垂直框架（平面）。
*   **轮廓挤出 (Profile Extrusion)**: 将矩形轮廓（宽度 × 厚度）沿路径扫掠。
*   **板材细分 (Subdivision)**: 将桥面表面分割为独立的木板，以模拟真实构造。

### 1.2 支撑结构 (Support Structure)
*   **射线投射 (Raycasting)**: 在每个框架位置，向下（-Z 向量）投射射线，与提供的 `Terrain` 地形网格求交。
*   **立柱生成 (Column Generation)**: 如果找到交点，则从桥面底部生成垂直圆柱（立柱）至地形交点。
*   **自适应高度 (Adaptive Height)**: 立柱长度根据地形起伏自动调整。

### 1.3 栏杆系统 (Railing System)
*   **偏移 (Offset)**: 通过偏移主路径生成左右两侧的栏杆曲线。
*   **立柱 (Posts)**: 沿栏杆曲线按固定间隔放置垂直立柱。
*   **扶手 (Handrails)**: 沿立柱顶部扫掠连续的扶手轮廓。

---

## 2. 散布系统 (Scatter System)
散布系统旨在实现基于规则的景观元素分布，确保布置既自然又受控。

### 2.1 泊松盘采样 (Poisson Disk Sampling)
为了避免乔木或家具出现不自然的重叠，我们实现了 **泊松盘采样 (Poisson Disk Sampling)**：
1.  **生成候选点**: 在表面上随机生成大量候选点。
2.  **距离检查**: 对于每个新点，检查它是否在任何现有点的距离 `r` (MinDistance) 之内。
3.  **接受/拒绝**: 仅接受满足距离约束的点。

### 2.2 对齐规则 (Alignment Rules)
*   **道路边缘对齐**: 对于路灯，点不是随机的。我们在 `RoadEdges` 曲线上按固定间隔采样。
*   **方向 (Orientation)**:
    *   **路灯**: 垂直于道路边缘朝向。
    *   **座椅**: 平行于路径或面向景观视点。
